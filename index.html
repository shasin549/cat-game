<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Imposter</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div id="app" class="container mx-auto px-4 py-8">
        <!-- Landing Page -->
        <div id="landingPage" class="fade-in">
            <div class="max-w-md mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
                <h1 class="text-3xl font-bold text-center mb-2 text-blue-400">Word Imposter</h1>
                <p class="text-center text-gray-400 mb-6">A social deduction game where you need to find the imposter!</p>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Your Name</label>
                    <input type="text" id="playerName" class="w-full p-2 bg-gray-700 rounded-md" placeholder="Enter your name">
                </div>
                
                <div class="space-y-3">
                    <button id="createRoomBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-md transition">
                        Create Room
                    </button>
                    
                    <div class="relative my-4">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-gray-600"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-2 bg-gray-800 text-gray-400">Or</span>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Room Code</label>
                        <input type="text" id="roomCode" class="w-full p-2 bg-gray-700 rounded-md uppercase" placeholder="Enter room code">
                    </div>
                    
                    <button id="joinRoomBtn" class="w-full bg-green-600 hover:bg-green-700 text-white p-2 rounded-md transition">
                        Join Room
                    </button>
                </div>
            </div>
        </div>

        <!-- Lobby Page -->
        <div id="lobbyPage" class="hidden fade-in">
            <div class="max-w-md mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-center mb-2">Room: <span id="roomCodeDisplay" class="text-blue-400"></span></h2>
                <p class="text-center text-gray-400 mb-6">Share this code with other players</p>
                
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-2">Players (<span id="playerCount">0</span>)</h3>
                    <div id="playersList" class="space-y-2">
                        <!-- Players will be added here -->
                    </div>
                </div>

                <button id="startGameBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-md transition">
                    Start Game
                </button>
            </div>
        </div>

        <!-- Word Input Page -->
        <div id="wordInputPage" class="hidden fade-in">
            <div class="max-w-md mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-center mb-6">Enter a Word</h2>
                
                <div class="mb-4">
                    <p class="text-center text-gray-400 mb-4">Each player will enter a word. One will be randomly selected as the secret word.</p>
                    <textarea id="wordInput" class="w-full p-3 bg-gray-700 rounded-md h-24" placeholder="Enter your word here..."></textarea>
                </div>

                <button id="submitWordBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-md transition">
                    Submit Word
                </button>
            </div>
        </div>

        <!-- Game Page -->
        <div id="gamePage" class="hidden fade-in">
            <div class="max-w-md mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-center mb-6">Word Imposter</h2>
                
                <div id="imposterView" class="hidden text-center mb-6">
                    <div class="bg-red-900 border border-red-700 px-4 py-3 rounded mb-4">
                        <p class="font-bold text-xl">You are the Imposter!</p>
                        <p>Try to blend in and guess the word.</p>
                    </div>
                </div>
                
                <div id="crewView" class="hidden text-center mb-6">
                    <p class="text-sm text-gray-400 mb-2">The secret word is:</p>
                    <p id="secretWord" class="text-3xl font-bold text-blue-400 mb-4 pulse"></p>
                    <p class="text-sm text-gray-400">Don't reveal it directly!</p>
                </div>

                <div class="mt-6 p-4 bg-yellow-900 border border-yellow-700 rounded-md">
                    <h3 class="font-semibold mb-2">How to play:</h3>
                    <ul class="text-sm list-disc list-inside space-y-1">
                        <li>Discuss the word indirectly without saying it</li>
                        <li>Imposter should try to blend in</li>
                        <li>Vote for who you think is the imposter</li>
                    </ul>
                </div>

                <button id="startVotingBtn" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white p-2 rounded-md transition mt-6">
                    Proceed to Voting
                </button>
            </div>
        </div>

        <!-- Voting Page -->
        <div id="votingPage" class="hidden fade-in">
            <div class="max-w-md mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-center mb-6">Voting Time</h2>
                <p class="text-center text-gray-400 mb-6">Who do you think is the Imposter?</p>
                
                <div id="votingPlayers" class="space-y-3">
                    <!-- Players will be added here -->
                </div>

                <p id="waitingVotes" class="text-center text-gray-400 mt-4 hidden">Waiting for other players to vote...</p>
            </div>
        </div>

        <!-- Results Page -->
        <div id="resultsPage" class="hidden fade-in">
            <div class="max-w-md mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-center mb-6">Game Results</h2>
                
                <div id="crewWin" class="hidden bg-green-900 border border-green-700 p-4 rounded-md mb-6">
                    <p class="text-center font-bold text-lg">✅ Crew Wins!</p>
                </div>
                
                <div id="imposterWin" class="hidden bg-red-900 border border-red-700 p-4 rounded-md mb-6">
                    <p class="text-center font-bold text-lg">❌ Imposter Wins!</p>
                </div>

                <div class="space-y-4 mb-6">
                    <div>
                        <p class="font-semibold">Secret Word:</p>
                        <p id="resultWord" class="text-xl text-blue-400"></p>
                    </div>
                    
                    <div>
                        <p class="font-semibold">The Imposter was:</p>
                        <p id="imposterName" class="text-xl text-red-400"></p>
                    </div>

                    <div>
                        <p class="font-semibold">Votes:</p>
                        <div id="voteResults" class="mt-2">
                            <!-- Vote results will be added here -->
                        </div>
                    </div>
                </div>

                <button id="playAgainBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-md transition">
                    Play Again
                </button>
            </div>
        </div>
    </div>

    <script>
        // Mock socket.io implementation for demonstration
        const mockSocket = {
            emit: (event, data) => {
                console.log(`Emitting ${event}:`, data);
                
                // Simulate server responses
                if (event === 'createRoom') {
                    setTimeout(() => {
                        const roomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
                        mockListeners.roomCreated({ roomCode });
                    }, 500);
                }
                
                if (event === 'joinRoom') {
                    setTimeout(() => {
                        if (data.roomCode.length !== 6) {
                            mockListeners.error({ message: 'Room not found' });
                        } else {
                            mockListeners.playerJoined({ 
                                players: [
                                    { id: 'host', name: data.playerName, isHost: true },
                                    { id: 'player2', name: 'Player 2', isHost: false },
                                    { id: 'player3', name: 'Player 3', isHost: false }
                                ] 
                            });
                        }
                    }, 500);
                }
                
                if (event === 'startGame') {
                    setTimeout(() => {
                        mockListeners.gameStarted({ 
                            players: [
                                { id: 'host', name: document.getElementById('playerName').value, isImposter: false },
                                { id: 'player2', name: 'Player 2', isImposter: true },
                                { id: 'player3', name: 'Player 3', isImposter: false }
                            ] 
                        });
                    }, 1000);
                }
                
                if (event === 'submitWord') {
                    setTimeout(() => {
                        mockListeners.wordSubmitted({ status: 'received' });
                    }, 300);
                }
                
                if (event === 'startVoting') {
                    setTimeout(() => {
                        mockListeners.votingStarted({ 
                            players: [
                                { id: 'host', name: document.getElementById('playerName').value },
                                { id: 'player2', name: 'Player 2' },
                                { id: 'player3', name: 'Player 3' }
                            ] 
                        });
                    }, 500);
                }
                
                if (event === 'submitVote') {
                    setTimeout(() => {
                        mockListeners.voteResults({ 
                            votes: {
                                host: 1,
                                player2: 2,
                                player3: 0
                            },
                            eliminatedPlayer: 'Player 2',
                            winner: 'crew',
                            word: 'ELEPHANT',
                            imposter: 'Player 2'
                        });
                    }, 1500);
                }
                
                if (event === 'playAgain') {
                    setTimeout(() => {
                        mockListeners.gameReset({ 
                            players: [
                                { id: 'host', name: document.getElementById('playerName').value, isHost: true },
                                { id: 'player2', name: 'Player 2', isHost: false },
                                { id: 'player3', name: 'Player 3', isHost: false }
                            ] 
                        });
                    }, 500);
                }
            },
            on: (event, callback) => {
                mockListeners[event] = callback;
            },
            off: (event) => {
                delete mockListeners[event];
            }
        };

        const mockListeners = {};
        const socket = mockSocket; // Replace with real socket.io connection in production

        // Game state
        let gameState = {
            roomCode: '',
            playerName: '',
            isHost: false,
            players: [],
            isImposter: false,
            secretWord: '',
            imposterId: ''
        };

        // DOM Elements
        const pages = {
            landing: document.getElementById('landingPage'),
            lobby: document.getElementById('lobbyPage'),
            wordInput: document.getElementById('wordInputPage'),
            game: document.getElementById('gamePage'),
            voting: document.getElementById('votingPage'),
            results: document.getElementById('resultsPage')
        };

        // Socket event handlers
        socket.on('roomCreated', (data) => {
            gameState.roomCode = data.roomCode;
            document.getElementById('roomCodeDisplay').textContent = data.roomCode;
            showPage('lobby');
        });

        socket.on('playerJoined', (data) => {
            gameState.players = data.players;
            updatePlayersList();
        });

        socket.on('gameStarted', (data) => {
            gameState.players = data.players;
            const imposter = data.players.find(p => p.isImposter);
            gameState.isImposter = imposter && imposter.id === 'host'; // In real app, compare with actual player id
            
            if (gameState.isHost) {
                showPage('wordInput');
            } else {
                // For demo, simulate word submission for non-host players
                setTimeout(() => {
                    showPage('game');
                    if (gameState.isImposter) {
                        document.getElementById('imposterView').classList.remove('hidden');
                    } else {
                        document.getElementById('crewView').classList.remove('hidden');
                        document.getElementById('secretWord').textContent = 'ELEPHANT';
                    }
                }, 2000);
            }
        });

        socket.on('wordSubmitted', (data) => {
            if (data.status === 'received') {
                showPage('game');
                if (gameState.isImposter) {
                    document.getElementById('imposterView').classList.remove('hidden');
                } else {
                    document.getElementById('crewView').classList.remove('hidden');
                    document.getElementById('secretWord').textContent = 'ELEPHANT';
                }
            }
        });

        socket.on('votingStarted', (data) => {
            gameState.players = data.players;
            showVotingOptions();
            showPage('voting');
        });

        socket.on('voteResults', (data) => {
            showResults(data);
            showPage('results');
        });

        socket.on('gameReset', (data) => {
            gameState.players = data.players;
            updatePlayersList();
            showPage('lobby');
        });

        socket.on('error', (data) => {
            alert(data.message);
        });

        // UI Functions
        function showPage(pageName) {
            // Hide all pages
            Object.values(pages).forEach(page => {
                page.classList.add('hidden');
            });
            
            // Show the requested page
            pages[pageName].classList.remove('hidden');
        }

        function updatePlayersList() {
            const playersList = document.getElementById('playersList');
            const playerCount = document.getElementById('playerCount');
            
            playersList.innerHTML = '';
            playerCount.textContent = gameState.players.length;
            
            gameState.players.forEach(player => {
                const playerEl = document.createElement('div');
                playerEl.className = 'p-2 bg-gray-700 rounded-md';
                playerEl.textContent = `${player.name} ${player.isHost ? '(Host)' : ''}`;
                playersList.appendChild(playerEl);
            });
        }

        function showVotingOptions() {
            const votingPlayers = document.getElementById('votingPlayers');
            votingPlayers.innerHTML = '';
            
            gameState.players.forEach(player => {
                const button = document.createElement('button');
                button.className = 'w-full p-3 bg-gray-700 hover:bg-gray-600 rounded-md text-left transition';
                button.textContent = player.name;
                button.onclick = () => {
                    socket.emit('submitVote', { 
                        roomCode: gameState.roomCode, 
                        voteFor: player.id 
                    });
                    document.getElementById('waitingVotes').classList.remove('hidden');
                    
                    // Disable all buttons after voting
                    document.querySelectorAll('#votingPlayers button').forEach(btn => {
                        btn.disabled = true;
                    });
                };
                votingPlayers.appendChild(button);
            });
        }

        function showResults(data) {
            const isCrewWin = data.winner === 'crew';
            
            if (isCrewWin) {
                document.getElementById('crewWin').classList.remove('hidden');
            } else {
                document.getElementById('imposterWin').classList.remove('hidden');
            }
            
            document.getElementById('resultWord').textContent = data.word;
            document.getElementById('imposterName').textContent = data.imposter;
            
            const voteResults = document.getElementById('voteResults');
            voteResults.innerHTML = '';
            
            for (const [playerId, votes] of Object.entries(data.votes)) {
                const player = gameState.players.find(p => p.id === playerId);
                if (player) {
                    const voteEl = document.createElement('div');
                    voteEl.className = 'flex justify-between items-center py-1';
                    voteEl.innerHTML = `
                        <span>${player.name}</span>
                        <span class="bg-gray-700 px-2 py-1 rounded-md">${votes} votes</span>
                    `;
                    voteResults.appendChild(voteEl);
                }
            }
        }

        // Event Listeners
        document.getElementById('createRoomBtn').addEventListener('click', () => {
            gameState.playerName = document.getElementById('playerName').value.trim();
            if (!gameState.playerName) {
                alert('Please enter your name');
                return;
            }
            
            gameState.isHost = true;
            socket.emit('createRoom', { playerName: gameState.playerName });
        });

        document.getElementById('joinRoomBtn').addEventListener('click', () => {
            gameState.playerName = document.getElementById('playerName').value.trim();
            const roomCode = document.getElementById('roomCode').value.trim().toUpperCase();
            
            if (!gameState.playerName) {
                alert('Please enter your name');
                return;
            }
            
            if (!roomCode || roomCode.length !== 6) {
                alert('Please enter a valid room code');
                return;
            }
            
            gameState.roomCode = roomCode;
            socket.emit('joinRoom', { roomCode, playerName: gameState.playerName });
        });

        document.getElementById('startGameBtn').addEventListener('click', () => {
            socket.emit('startGame', { roomCode: gameState.roomCode });
        });

        document.getElementById('submitWordBtn').addEventListener('click', () => {
            const word = document.getElementById('wordInput').value.trim();
            if (!word) {
                alert('Please enter a word');
                return;
            }
            
            socket.emit('submitWord', { 
                roomCode: gameState.roomCode, 
                word 
            });
        });

        document.getElementById('startVotingBtn').addEventListener('click', () => {
            socket.emit('startVoting', { roomCode: gameState.roomCode });
        });

        document.getElementById('playAgainBtn').addEventListener('click', () => {
            socket.emit('playAgain', { roomCode: gameState.roomCode });
        });
    </script>
</body>
</html>